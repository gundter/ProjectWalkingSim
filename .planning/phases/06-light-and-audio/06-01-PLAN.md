---
phase: 06-light-and-audio
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Source/ProjectWalkingSim/Public/Lighting/FlashlightComponent.h
  - Source/ProjectWalkingSim/Private/Lighting/FlashlightComponent.cpp
  - Source/ProjectWalkingSim/Public/Audio/AudioConstants.h
autonomous: true

must_haves:
  truths:
    - "FlashlightComponent creates a narrow-cone spotlight attached to the player camera at runtime"
    - "AudioConstants.h provides centralized tuning constants for all Phase 6 audio systems"
  artifacts:
    - path: "Source/ProjectWalkingSim/Public/Lighting/FlashlightComponent.h"
      provides: "UFlashlightComponent declaration with beam tuning properties"
      contains: "class UFlashlightComponent"
    - path: "Source/ProjectWalkingSim/Private/Lighting/FlashlightComponent.cpp"
      provides: "Runtime USpotLightComponent creation in BeginPlay"
      contains: "NewObject<USpotLightComponent>"
    - path: "Source/ProjectWalkingSim/Public/Audio/AudioConstants.h"
      provides: "AudioConstants namespace with tuning values"
      contains: "namespace AudioConstants"
  key_links:
    - from: "FlashlightComponent.cpp"
      to: "UCameraComponent"
      via: "FindComponentByClass in BeginPlay"
      pattern: "FindComponentByClass<UCameraComponent>"
---

<objective>
Create the FlashlightComponent (narrow spotlight on player camera) and AudioConstants header (centralized tuning for all Phase 6 audio).

Purpose: FlashlightComponent delivers LGHT-01 (flashlight always on). AudioConstants.h provides shared tuning constants consumed by Plans 02-05. These are independent foundational pieces that unblock parallel work.

Output: FlashlightComponent.h/.cpp in Lighting/, AudioConstants.h in Audio/. Both compile cleanly.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-light-and-audio/06-RESEARCH.md
@.planning/phases/06-light-and-audio/06-CONTEXT.md
@Source/ProjectWalkingSim/Public/Player/SereneCharacter.h
@Source/ProjectWalkingSim/ProjectWalkingSim.Build.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AudioConstants.h</name>
  <files>Source/ProjectWalkingSim/Public/Audio/AudioConstants.h</files>
  <action>
Create the Audio/ directory under Public/ and add AudioConstants.h with a namespace of centralized tuning constants for all Phase 6 audio systems.

```cpp
// Copyright Null Lantern.
#pragma once

/**
 * Audio tuning constants for The Juniper Tree.
 * Centralized defaults for audio systems added in Phase 6.
 * Individual components may override via UPROPERTY editable values.
 */
namespace AudioConstants
{
    // --- Monster Audio ---

    /** Default footstep interval at patrol speed (seconds). */
    constexpr float MonsterFootstepInterval_Patrol = 0.8f;

    /** Footstep interval during investigation (seconds). */
    constexpr float MonsterFootstepInterval_Investigate = 0.6f;

    /** Footstep interval during chase (seconds). */
    constexpr float MonsterFootstepInterval_Chase = 0.35f;

    /** Footstep interval during search (seconds). */
    constexpr float MonsterFootstepInterval_Search = 0.7f;

    /** Monster breathing crossfade duration when switching states (seconds). */
    constexpr float BreathingCrossfadeDuration = 1.5f;

    /** Chance (0-1) of a one-shot vocalization when entering a new behavior state. */
    constexpr float VocalizationChance = 0.6f;

    // --- Music Tension ---

    /** Default music crossfade duration (seconds). */
    constexpr float MusicCrossfadeDuration = 3.0f;

    /** Volume for the active music layer (0-1). */
    constexpr float MusicActiveVolume = 0.7f;

    // --- Ambient Audio ---

    /** Minimum interval between random one-shot ambient sounds (seconds). */
    constexpr float AmbientOneShotMinInterval = 5.0f;

    /** Maximum interval between random one-shot ambient sounds (seconds). */
    constexpr float AmbientOneShotMaxInterval = 20.0f;

    /** Predator silence fade-out duration (seconds). */
    constexpr float PredatorSilenceFadeOut = 2.0f;

    /** Predator silence fade-in (restore) duration (seconds). */
    constexpr float PredatorSilenceFadeIn = 3.0f;

    // --- Player Proximity ---

    /** Maximum distance (cm) at which heartbeat activates (~30m). */
    constexpr float HeartbeatMaxDistance = 3000.0f;

    /** Distance (cm) at which heartbeat is at max intensity (~5m). */
    constexpr float HeartbeatMinDistance = 500.0f;

    /** Update rate for heartbeat proximity check (Hz). */
    constexpr float HeartbeatUpdateRate = 4.0f;

    // --- Player Footstep Audio ---

    /** Base volume multiplier for player footstep audio playback. */
    constexpr float PlayerFootstepBaseVolume = 0.6f;

    // --- Flashlight ---

    /** Interval (seconds) for flashlight-to-Wendigo detection trace. */
    constexpr float FlashlightDetectionInterval = 0.5f;

    /** Half-angle (degrees) of the flashlight detection cone. */
    constexpr float FlashlightDetectionHalfAngle = 15.0f;

    /** Range (cm) of the flashlight detection trace (~15m, matches light attenuation). */
    constexpr float FlashlightDetectionRange = 1500.0f;
}
```

Follow the same pattern as AIConstants in MonsterAITypes.h -- constexpr values in a namespace, no USTRUCT needed.
  </action>
  <verify>File compiles: add a temporary #include in an existing .cpp or verify via build.</verify>
  <done>AudioConstants.h exists in Public/Audio/ with all tuning constants for Phase 6 systems.</done>
</task>

<task type="auto">
  <name>Task 2: Create FlashlightComponent</name>
  <files>
    Source/ProjectWalkingSim/Public/Lighting/FlashlightComponent.h
    Source/ProjectWalkingSim/Private/Lighting/FlashlightComponent.cpp
  </files>
  <action>
Create the Lighting/ directories under Public/ and Private/. Implement UFlashlightComponent as a UActorComponent that creates and owns a USpotLightComponent at runtime.

**Header (FlashlightComponent.h):**
- UCLASS with ClassGroup=(Custom), BlueprintSpawnableComponent
- Inherits UActorComponent
- UPROPERTY editable beam properties: InnerConeAngle (14.0f), OuterConeAngle (28.0f), Intensity (8000.0f lumens), AttenuationRadius (1500.0f cm), LightColor (FLinearColor(0.85f, 0.92f, 1.0f) -- cool bluish-white LED), VolumetricScatteringIntensity (1.0f)
- UPROPERTY for TObjectPtr<USpotLightComponent> SpotLight (private)
- Override BeginPlay()
- No Tick -- flashlight is always on, light moves with camera attachment automatically

**Implementation (FlashlightComponent.cpp):**
- In BeginPlay():
  1. Call Super::BeginPlay()
  2. Get owner actor, find UCameraComponent via FindComponentByClass<UCameraComponent>()
  3. If no camera found, log warning and return
  4. Create SpotLight via NewObject<USpotLightComponent>(Owner, TEXT("FlashlightSpotLight"))
  5. Call SpotLight->SetupAttachment(Camera)
  6. Apply all beam properties from UPROPERTY values
  7. Set CastShadows(true), Mobility(Movable)
  8. Call SpotLight->RegisterComponent()
  9. Log success at Verbose level

**Critical: Do NOT use CreateDefaultSubobject** -- that only works in actor constructors. NewObject + RegisterComponent is the correct pattern for component-created sub-components.

**Performance note:** Keep VolumetricScatteringIntensity at 1.0 (tunable). The research warns about volumetric fog ghosting with fast-moving spotlights. If ghosting appears, this value should be reduced to 0.5 or 0.

Include forward declarations where possible, full includes only in .cpp.
  </action>
  <verify>
Project compiles successfully with both new files. Verify:
1. No linker errors
2. No UHT generation errors
3. `UFlashlightComponent` appears in class viewer
  </verify>
  <done>FlashlightComponent.h/.cpp exist in Lighting/ directories, compile cleanly, and create a USpotLightComponent attached to the camera in BeginPlay.</done>
</task>

</tasks>

<verification>
1. Project compiles with zero errors after both files added
2. No new warnings related to Lighting/ or Audio/ code
3. AudioConstants.h values are accessible from other translation units
4. FlashlightComponent creates SpotLight in BeginPlay (verify via log output)
</verification>

<success_criteria>
- FlashlightComponent.h/.cpp compile and create a narrow-cone spotlight on the player camera
- AudioConstants.h provides all tuning constants needed by Plans 02-05
- No Build.cs changes needed (Engine module already included)
- Project builds cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/06-light-and-audio/06-01-SUMMARY.md`
</output>
