---
phase: 07-save-system
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - Source/ProjectWalkingSim/Public/Player/HUD/GameOverWidget.h
  - Source/ProjectWalkingSim/Private/Player/HUD/GameOverWidget.cpp
  - Source/ProjectWalkingSim/Public/Player/HUD/SaveSlotWidget.h
  - Source/ProjectWalkingSim/Private/Player/HUD/SaveSlotWidget.cpp
  - Source/ProjectWalkingSim/Public/Player/HUD/SaveLoadMenuWidget.h
  - Source/ProjectWalkingSim/Private/Player/HUD/SaveLoadMenuWidget.cpp
autonomous: true

must_haves:
  truths:
    - "Game Over screen displays with Load Last Save and Quit buttons"
    - "Save slot widget shows screenshot thumbnail, timestamp, and empty/occupied state"
    - "Save/Load menu displays 3 slots and supports both save mode and load mode"
    - "Overwriting an occupied save slot shows confirmation prompt"
  artifacts:
    - path: "Source/ProjectWalkingSim/Public/Player/HUD/GameOverWidget.h"
      provides: "Game Over death screen C++ base class"
      contains: "class UGameOverWidget"
    - path: "Source/ProjectWalkingSim/Public/Player/HUD/SaveSlotWidget.h"
      provides: "Individual save slot display widget"
      contains: "class USaveSlotWidget"
    - path: "Source/ProjectWalkingSim/Public/Player/HUD/SaveLoadMenuWidget.h"
      provides: "3-slot save/load menu with mode toggle"
      contains: "class USaveLoadMenuWidget"
  key_links:
    - from: "GameOverWidget.cpp"
      to: "SaveSubsystem"
      via: "LoadLatestSave and HasAnySave calls"
      pattern: "LoadLatestSave|HasAnySave"
    - from: "SaveLoadMenuWidget.cpp"
      to: "SaveSubsystem"
      via: "SaveToSlot/LoadFromSlot/GetSlotInfo"
      pattern: "SaveToSlot|LoadFromSlot|GetSlotInfo"
    - from: "SaveSlotWidget.cpp"
      to: "FImageUtils::ImportBufferAsTexture2D"
      via: "Thumbnail reconstruction from saved JPEG bytes"
      pattern: "ImportBufferAsTexture2D"
---

<objective>
Create all save system UI widgets: Game Over death screen, individual save slot display, and the save/load menu that supports both saving (from tape recorder) and loading (from pause menu). These are C++ base classes that will have UMG Blueprint subclasses for layout.

Purpose: The Game Over widget is used by SereneGameMode::OnPlayerDeath (Plan 02). The SaveLoadMenuWidget is used by TapeRecorderActor for saving and PauseMenuWidget for loading (Plan 04). These widgets must exist before the final wiring plan.

Output: Three C++ widget base classes with full logic, ready for UMG Blueprint subclasses.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-save-system/07-CONTEXT.md
@.planning/phases/07-save-system/07-RESEARCH.md
@.planning/phases/07-save-system/07-01-SUMMARY.md

Key existing widget patterns:
@Source/ProjectWalkingSim/Public/Player/HUD/InventoryWidget.h (widget pattern reference)
@Source/ProjectWalkingSim/Public/Player/HUD/InventorySlotWidget.h (slot widget pattern)
@Source/ProjectWalkingSim/Public/Player/HUD/StaminaBarWidget.h (simple widget pattern)
@Source/ProjectWalkingSim/Public/Save/SaveSubsystem.h (from 07-01)
@Source/ProjectWalkingSim/Public/Save/SaveTypes.h (FSaveSlotInfo from 07-01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: GameOverWidget -- death screen with Load Last Save / Quit</name>
  <files>
    Source/ProjectWalkingSim/Public/Player/HUD/GameOverWidget.h
    Source/ProjectWalkingSim/Private/Player/HUD/GameOverWidget.cpp
  </files>
  <action>
**GameOverWidget.h** -- UGameOverWidget : public UUserWidget

This is the death screen shown when the Wendigo kills the player. Displays "Game Over" text and two buttons.

BindWidget members (named to match UMG Blueprint children):
- `TObjectPtr<UTextBlock> GameOverText` -- "GAME OVER" title text.
- `TObjectPtr<UButton> LoadLastSaveButton` -- Loads the most recent save.
- `TObjectPtr<UTextBlock> LoadLastSaveButtonText` -- Text on the load button. Shows "Load Last Save" if saves exist, "Restart" if no saves.
- `TObjectPtr<UButton> QuitButton` -- Quits to desktop.

Override NativeConstruct:
- Query SaveSubsystem->HasAnySave(). If true, set LoadLastSaveButtonText to "Load Last Save". If false, set to "Restart".
- Bind LoadLastSaveButton OnClicked to HandleLoadClicked.
- Bind QuitButton OnClicked to HandleQuitClicked.

Private handlers:
- `HandleLoadClicked()`: If HasAnySave(), call SaveSubsystem->LoadLatestSave(). Else, call UGameplayStatics::OpenLevel to restart the current map (fresh start).
- `HandleQuitClicked()`: Call UKismetSystemLibrary::QuitGame(GetWorld(), nullptr, EQuitPreference::Quit, false).

Get SaveSubsystem via: `GetGameInstance()->GetSubsystem<USaveSubsystem>()`.

Include: UButton.h (or Components/Button.h), UTextBlock.h (or Components/TextBlock.h), SaveSubsystem.h.

**GameOverWidget.cpp** -- Full implementation of NativeConstruct, HandleLoadClicked, HandleQuitClicked.

Follow existing widget patterns in the project: use BindWidget meta for child widget references, keep logic in C++ base class so the UMG Blueprint only handles layout/styling.
  </action>
  <verify>Project compiles. GameOverWidget.h has BindWidget members for GameOverText, LoadLastSaveButton, QuitButton. NativeConstruct binds button delegates.</verify>
  <done>GameOverWidget shows death screen with dynamic button text (Load Last Save vs Restart). Load button calls SaveSubsystem. Quit button exits game.</done>
</task>

<task type="auto">
  <name>Task 2: SaveSlotWidget + SaveLoadMenuWidget -- slot display and 3-slot menu</name>
  <files>
    Source/ProjectWalkingSim/Public/Player/HUD/SaveSlotWidget.h
    Source/ProjectWalkingSim/Private/Player/HUD/SaveSlotWidget.cpp
    Source/ProjectWalkingSim/Public/Player/HUD/SaveLoadMenuWidget.h
    Source/ProjectWalkingSim/Private/Player/HUD/SaveLoadMenuWidget.cpp
  </files>
  <action>
**SaveSlotWidget.h** -- USaveSlotWidget : public UUserWidget

Displays a single save slot: screenshot thumbnail, timestamp, and empty/occupied indicator. Clickable.

BindWidget members:
- `TObjectPtr<UImage> ThumbnailImage` -- Shows screenshot or placeholder for empty slots.
- `TObjectPtr<UTextBlock> TimestampText` -- "Feb 12, 2026 3:45 PM" or "Empty".
- `TObjectPtr<UTextBlock> SlotLabelText` -- "Slot 1", "Slot 2", "Slot 3".
- `TObjectPtr<UButton> SlotButton` -- The clickable area.

Public methods:
- `void SetSlotData(int32 InSlotIndex, const FSaveSlotInfo& Info, bool bIsOccupied)` -- Populates the widget. If bIsOccupied: reconstruct thumbnail texture from Info.ScreenshotData using FImageUtils::ImportBufferAsTexture2D, format timestamp. If empty: show placeholder text "Empty", use default/blank thumbnail.
- `int32 GetSlotIndex() const` -- Returns cached slot index.

Delegate:
- `DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(FOnSlotClicked, int32, SlotIndex)` -- Declared in header or as member delegate.
- `FOnSlotClicked OnSlotClicked` -- Broadcast when SlotButton is clicked.

Private:
- int32 SlotIndex = -1
- `void HandleSlotButtonClicked()` -- Broadcasts OnSlotClicked with SlotIndex.

Override NativeConstruct to bind SlotButton->OnClicked.

For thumbnail reconstruction: Use FImageUtils::ImportBufferAsTexture2D(TArrayView64<const uint8>(Data.GetData(), Data.Num())). If that returns a valid UTexture2D*, create a FSlateBrush or use UImage::SetBrushFromTexture(Texture). If data is empty, leave the default placeholder.

**SaveSlotWidget.cpp** -- Full implementation.

**SaveLoadMenuWidget.h** -- USaveLoadMenuWidget : public UUserWidget

The 3-slot menu used for both saving (tape recorder) and loading (pause menu).

Enum for mode:
```cpp
UENUM(BlueprintType)
enum class ESaveLoadMode : uint8
{
    Save,
    Load
};
```

BindWidget members:
- `TObjectPtr<UTextBlock> MenuTitleText` -- "Save Game" or "Load Game".
- `TObjectPtr<USaveSlotWidget> Slot0` -- First slot widget.
- `TObjectPtr<USaveSlotWidget> Slot1` -- Second slot widget.
- `TObjectPtr<USaveSlotWidget> Slot2` -- Third slot widget.
- `TObjectPtr<UButton> BackButton` -- Close/cancel button.
- `TObjectPtr<UTextBlock> BackButtonText` -- "Back" or "Cancel".

Confirmation overlay (for overwrite):
- `TObjectPtr<UWidget> ConfirmOverlay` -- Container for confirmation prompt. Initially hidden.
- `TObjectPtr<UTextBlock> ConfirmText` -- "Overwrite this save?"
- `TObjectPtr<UButton> ConfirmYesButton` -- Confirm overwrite.
- `TObjectPtr<UButton> ConfirmNoButton` -- Cancel overwrite.

Public methods:
- `void OpenMenu(ESaveLoadMode Mode)` -- Sets mode, updates title text, refreshes all 3 slots via SaveSubsystem->GetSlotInfo(). Shows the widget.
- `void CloseMenu()` -- Hides widget, returns input to game.

Delegate:
- `DECLARE_DYNAMIC_MULTICAST_DELEGATE(FOnMenuClosed)` -- So the owner (tape recorder or pause menu) knows the menu was dismissed.
- `FOnMenuClosed OnMenuClosed`

Private:
- ESaveLoadMode CurrentMode
- int32 PendingOverwriteSlotIndex = -1 (slot awaiting overwrite confirmation)
- `void HandleSlotClicked(int32 SlotIndex)` -- In Save mode: if slot occupied, show confirmation overlay with PendingOverwriteSlotIndex. If empty, call SaveSubsystem->SaveToSlot(SlotIndex) directly, then CloseMenu(). In Load mode: if slot occupied, call SaveSubsystem->LoadFromSlot(SlotIndex). If empty, ignore click.
- `void HandleConfirmYes()` -- Call SaveSubsystem->SaveToSlot(PendingOverwriteSlotIndex), hide confirm overlay, CloseMenu().
- `void HandleConfirmNo()` -- Hide confirm overlay, reset PendingOverwriteSlotIndex.
- `void HandleBackClicked()` -- CloseMenu, broadcast OnMenuClosed.
- `void RefreshSlots()` -- For each slot (0-2): query SaveSubsystem->DoesSaveExist(i), if yes load GetSlotInfo(i) and call Slot->SetSlotData(i, info, true). If no, call Slot->SetSlotData(i, FSaveSlotInfo(), false).
- Helper: `TArray<USaveSlotWidget*> GetSlotWidgets()` -- Returns {Slot0, Slot1, Slot2} for iteration.

Override NativeConstruct to bind all button delegates.

**SaveLoadMenuWidget.cpp** -- Full implementation.

IMPORTANT: The ConfirmOverlay should be set to Collapsed visibility by default (in NativeConstruct or UMG). Only made Visible when overwrite confirmation is needed.

IMPORTANT: For input handling: when this menu is shown, the caller should set input mode to UI (Game+UI so the game doesn't unpause). The menu itself just calls SetVisibility and broadcasts delegates -- the caller manages input mode.
  </action>
  <verify>Project compiles. SaveSlotWidget has BindWidget for ThumbnailImage, TimestampText, SlotButton. SaveLoadMenuWidget has BindWidget for 3 slot widgets, confirm overlay, and back button. SaveLoadMenuWidget supports both Save and Load modes via OpenMenu(ESaveLoadMode).</verify>
  <done>SaveSlotWidget displays individual slot data with screenshot thumbnail reconstruction. SaveLoadMenuWidget provides 3-slot menu for both save and load with overwrite confirmation. Both are C++ base classes ready for UMG Blueprint subclasses.</done>
</task>

</tasks>

<verification>
1. Project compiles without errors
2. GameOverWidget has LoadLastSave and Quit button logic wired to SaveSubsystem
3. SaveSlotWidget reconstructs UTexture2D from compressed JPEG bytes
4. SaveLoadMenuWidget supports ESaveLoadMode::Save and ESaveLoadMode::Load
5. Overwrite confirmation overlay is functional (shown on occupied slot save, hidden on cancel)
6. All widgets use BindWidget meta for UMG Blueprint integration
</verification>

<success_criteria>
- GameOverWidget shows "Load Last Save" when saves exist, "Restart" when none exist
- SaveSlotWidget displays screenshot thumbnail, timestamp, or "Empty" state
- SaveLoadMenuWidget opens in Save or Load mode with correct behavior per mode
- Overwrite confirmation prevents accidental save slot replacement
- All widget classes compile and are ready for UMG Blueprint subclassing
</success_criteria>

<output>
After completion, create `.planning/phases/07-save-system/07-03-SUMMARY.md`
</output>
