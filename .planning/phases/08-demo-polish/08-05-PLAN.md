---
phase: 08-demo-polish
plan: 05
type: execute
wave: 4
depends_on: ["08-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Player can walk through the farmstead environment exploring cabin, cellar, woods, and barn"
    - "Opening detective monologue plays when the player starts the game"
    - "Notes and inspectable objects tell the story of the missing boy throughout the environment"
    - "Wendigo spawns at the midpoint when player enters the woods section"
    - "Demo ending triggers when player discovers the final cliffhanger object"
    - "Screen fades to black and shows 'The Juniper Tree' title card at demo end"
    - "Locked doors with keys gate progression through the environment"
    - "Tape recorders provide save opportunities at key points"
    - "Hiding spots are available throughout for evading the Wendigo"
  artifacts:
    - path: "Content/Maps/DemoMap.umap"
      provides: "Complete playable demo level"
  key_links:
    - from: "BP_NarrativeTrigger (opening)"
      to: "Opening monologue audio"
      via: "MonologueSound assigned, placed at PlayerStart"
      pattern: "Player overlap triggers detective monologue"
    - from: "BP_NarrativeTrigger (woods)"
      to: "WendigoSpawnPoint::SpawnWendigo"
      via: "OnNarrativeTriggered delegate"
      pattern: "Narrative trigger spawns Wendigo at midpoint"
    - from: "BP_DemoEndingTrigger"
      to: "DemoEndingManager::TriggerEnding"
      via: "Final area overlap triggers ending sequence"
      pattern: "Discovery triggers fade-to-black"
    - from: "NavMeshBoundsVolume"
      to: "Wendigo pathfinding"
      via: "Single large volume covering entire playable area"
      pattern: "show Navigation confirms coverage"
---

<objective>
Build the complete demo level: the rural farmstead environment with cabin, cellar, woods, and barn. Place all gameplay actors (narrative triggers, readables, inspectables, locked doors, keys, hiding spots, tape recorders, patrol routes, Wendigo spawn point, ambient audio). Wire the full 25-35 minute demo experience from opening monologue to ending cliffhanger.

Purpose: This is the culmination of all 7 prior phases -- assembling every gameplay system into a single cohesive demo experience. The player investigates an abandoned farmstead as a detective, reads notes about a missing boy, encounters the Wendigo in the woods, and discovers a horrifying truth at the climax. This fulfills all 4 DEMO requirements.

Output: A complete DemoMap level ready for playtesting.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-demo-polish/08-CONTEXT.md
@.planning/phases/08-demo-polish/08-RESEARCH.md
@.planning/phases/08-demo-polish/08-01-SUMMARY.md
@.planning/phases/08-demo-polish/08-02-SUMMARY.md
@.planning/phases/08-demo-polish/08-03-SUMMARY.md
@.planning/phases/08-demo-polish/08-04-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Build farmstead environment geometry and lighting</name>
  <action>
    Create the demo level (DemoMap) with the farmstead environment. This is the most substantial editor task in the project.

    **Level Creation:**
    - File -> New Level -> Empty Level, save as Content/Maps/DemoMap
    - Set as the default game map in Project Settings -> Maps & Modes

    **Environment Layout (from CONTEXT.md):**

    Build these areas using BSP brushes, Quixel/Marketplace assets, or simple geometry:

    1. **Cabin Exterior / Yard**
       - Flat terrain with grass, a dirt path leading to the cabin front door
       - Cabin structure: wooden, single-story with attic hatch, front porch
       - Ambient: moonlit night, overcast sky, fog
       - PlayerStart actor near the path leading to the cabin

    2. **Cabin Interior (Main Room + Kitchen)**
       - Main room: fireplace, desk with case file, closet (hiding spot), front door
       - Kitchen area: table, drawers, dim lighting
       - Wall thickness >= 10cm for Lumen (CRITICAL)
       - At least one dim point light per room

    3. **Cellar** (accessed via locked door in cabin)
       - Stairs down, cramped, dark
       - Shelving, old boxes
       - Under-stairs area (hiding spot)

    4. **Woods Section** (outside, between cabin and barn)
       - Trees, underbrush, winding path
       - Open and exposed feeling (contrast to cabin)
       - Moonlight filtering through trees

    5. **Barn**
       - Large wooden structure, partially collapsed
       - Stalls, hay bales, locker (hiding spot)
       - Second floor/loft area for the climax

    6. **Climax Area** (barn basement or secret room)
       - Small, hidden, disturbing
       - This is where the ending discovery happens

    **Lighting Setup:**
    - Directional Light as moonlight (low intensity, bluish)
    - SkyLight with nighttime cubemap
    - ExponentialHeightFog for atmosphere
    - Point/Spot lights in every enclosed room (dim, warm for cabin; cold for cellar)
    - Lumen settings: ensure r.MegaLights=1 in console or DefaultEngine.ini
    - Verify wall thickness >= 10cm to prevent Lumen light leaking

    **NavMesh:**
    - Place ONE large NavMeshBoundsVolume covering the entire playable area (cabin + yard + woods + barn)
    - Add NavModifierVolumes on impassable zones (dense forest edges, walls, cliffs)
    - Test: `show Navigation` in PIE to verify green coverage over all walkable surfaces
    - Verify indoor-outdoor transitions work at doorways
  </action>
  <how-to-verify>
    1. PIE: Player spawns near cabin, can walk to cabin, through woods, to barn
    2. `show Navigation` shows green NavMesh covering all walkable surfaces
    3. No light leaking through walls (check interior rooms)
    4. Every enclosed room has at least one light source
    5. Atmosphere feels like nighttime horror (dark, moody, foggy)
  </how-to-verify>
  <resume-signal>Type "environment done" when the level geometry, lighting, and NavMesh are complete</resume-signal>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Place all gameplay actors and wire the demo experience</name>
  <action>
    Place all gameplay actors from Phases 1-8 into DemoMap. Follow this placement guide:

    **Narrative Triggers (DEMO-02: Opening Hook):**
    - BP_NarrativeTrigger at PlayerStart (TriggerDelay=1.0s, bOneShot=true)
      - Assign opening MonologueSound (placeholder: use any WAV/audio asset, or create a silent placeholder)
      - SubtitleText: "Another missing kid case. Caleb Wright, age 8. Last seen near his family's farm..."
    - BP_NarrativeTrigger in cabin main room (triggered when player finds desk)
      - MonologueSound for "case file" reaction monologue
    - BP_NarrativeTrigger at woods entry
      - MonologueSound for "something feels wrong out here" monologue

    **Wendigo Spawn Trigger:**
    - BP_NarrativeTrigger deeper in the woods (this triggers Wendigo spawn)
      - In Event Graph: bind OnNarrativeTriggered to call SpawnWendigo on the WendigoSpawnPoint
      - OR: create a separate Blueprint that references both the trigger and spawn point
    - WendigoSpawnPoint in the woods area
      - Assign BP_WendigoCharacter class
      - Assign a PatrolRouteActor with waypoints through the woods and toward the barn

    **PatrolRouteActor:**
    - PatrolRouteActor_Woods: 4-6 waypoints through the woods and around the barn exterior
    - Place waypoints where NavMesh exists (verify with show Navigation)

    **Readable Notes (DEMO-03: Environmental Storytelling):**
    - BP_ReadableActor on cabin desk: "Case File - Caleb Wright" (overview of missing boy case)
    - BP_ReadableActor in cellar: "Journal Entry" (father's journal, hints at disturbing behavior)
    - BP_ReadableActor in barn: "Final Note" (most disturbing, hints at the truth)

    **Inspectable Objects (DEMO-03: Environmental Storytelling):**
    - BP_InspectableActor in cellar: "Old Family Photo" (InspectionText about the family, assign placeholder texture)
    - BP_InspectableActor in barn: "Child's Toy" (InspectionText about Caleb's favorite toy)
    - BP_InspectableActor in climax area: "The Discovery" (the ending object -- this is what triggers the ending)

    **Locked Doors + Keys (Progression Gating):**
    - DoorActor (cabin front door): unlocked, first entry point
    - DoorActor (cellar door): locked, RequiredItemId matches CellarKey
    - PickupActor (Cellar Key): in cabin desk drawer (DrawerActor)
    - DoorActor (barn door): locked, RequiredItemId matches BarnKey
    - PickupActor (Barn Key): found in cellar or woods area
    - Create ItemDataAssets for CellarKey and BarnKey (Content/Items/)

    **Hiding Spots:**
    - HidingSpotActor in cabin main room closet
    - HidingSpotActor under cellar stairs
    - HidingSpotActor in barn (locker or behind hay bales)
    - Assign appropriate HidingSpotDataAssets

    **Save Points:**
    - TapeRecorderActor in cabin main room (first save opportunity)
    - TapeRecorderActor in barn (second save before climax)

    **Ambient Audio:**
    - AmbientAudioManager near cabin (cabin exterior/interior ambience)
    - AmbientAudioManager in woods (forest ambience -- wind, owl hoots)

    **Demo Ending (DEMO-04):**
    - BP_DemoEndingTrigger in the climax area, right after the final InspectableActor
    - OR: wire the final InspectableActor's interaction to trigger the ending
      - Option A: Place BP_DemoEndingTrigger after the discovery object (overlap trigger)
      - Option B: In BP_InspectableActor_Discovery Event Graph, bind interaction to call DemoEndingManager::TriggerEnding
    - Ensure DemoEndingManager has TitleCardWidgetClass = WBP_TitleCard assigned
    - Set FadeDuration = 3.0, TitleCardDelay = 2.0
    - Optionally assign FinalMonologue audio for a last detective line before fade
  </action>
  <how-to-verify>
    1. PIE: Walk to cabin, opening monologue plays
    2. PIE: Read case file on desk, document overlay appears and can be closed with E/Esc
    3. PIE: Find cellar key in drawer, unlock cellar door
    4. PIE: Inspect photo in cellar, image overlay appears
    5. PIE: Walk into woods, Wendigo spawns and begins patrolling
    6. PIE: Can hide from Wendigo in hiding spots
    7. PIE: Can save at tape recorder
    8. PIE: Find barn key, enter barn, read final note
    9. PIE: Reach climax area, trigger ending -- screen fades to black, "The Juniper Tree" title appears
    10. PIE: `stat fps` shows >= 60 FPS in most areas
  </how-to-verify>
  <resume-signal>Type "demo wired" when all actors are placed and the full demo flow works in PIE</resume-signal>
</task>

</tasks>

<verification>
1. Complete walkthrough from start to ending in PIE without crashes
2. Opening monologue plays at game start
3. All notes/inspectable objects display correctly and can be closed
4. Locked doors require correct keys
5. Wendigo spawns at midpoint and patrols/chases/searches correctly
6. Hiding spots work (player can enter and exit)
7. Save/load works at tape recorders
8. Demo ending plays: fade to black, audio fades, "The Juniper Tree" title card appears
9. NavMesh covers all walkable areas (show Navigation)
10. Performance: `stat fps` >= 60 in most areas, `stat unit` GPU < 16.6ms
</verification>

<success_criteria>
- DEMO-01: Abandoned farmstead environment is built and explorable (cabin, cellar, woods, barn)
- DEMO-02: Opening detective monologue plays when the game starts, establishing the case
- DEMO-03: Notes and inspectable objects tell the story throughout the environment (minimum 6 objects)
- DEMO-04: Demo ends with a discovery cliffhanger, fade to black, and "The Juniper Tree" title card
- Performance: 60 FPS target maintained
</success_criteria>

<output>
After completion, create `.planning/phases/08-demo-polish/08-05-SUMMARY.md`
</output>
